# 极客时间--MySQL实战45讲--第10讲：mysql为什么选错索引

* 优化器选择索引的目的，是找到一个最优的方案，用最小的代价去执行语句。在数据库里，扫描行数是影响代价的因素之一。扫描的行数越少，消耗的CPU越少。除了行数，优化器还会结合使用是否使用临时表、是否排序等因素综合考虑
* 扫描行数是怎么判断的：
    - mysql只能通过统计来估算扫描行数，这个统计信息就是索引的“区分度”，一个索引上不同值的个数，称为“基数”，显然，基数越大越好
    - mysql如何得到索引的基数：mysql不会取出整个表，一行一行统计，因为代价太高。InnoDB会默认选择N个数据页，统计这些页面上的不同值，得到一个平均值，然后乘以这个所索引的总页数，就得到这个索引的基数。当更新的行数超过1/M时，会触发一次重新统计索引

两种统计索引的方式，设置innodb_stats_persistent：
* 设置为on的时候，统计信息会持久化，N是20，M是10
* 设置为off的时候，统计信息值存在内存，这时N是8，M是16

* 索引选择异常和处理：
    - 采用force index
    - 修改语句，引导MySQL使用我们期望的索引
    - 新建一个更合适的索引，来提供给优化器做选择，或删掉误用的索引
