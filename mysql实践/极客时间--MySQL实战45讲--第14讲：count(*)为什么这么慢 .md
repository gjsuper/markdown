# 极客时间--MySQL实战45讲--第14讲：count(*)为什么这么慢

* count(*)在不同的MySQL引擎中的实现方式是不一样的
    - 在MyISAM引擎中把表的总行数存在磁盘里，执行count(*)时会直接返回这个数，效率很高，（没有where）
    - InnodB需要把数据一行行读出来
- InnoDB由于使用了多版本控制，所以同一时刻的多个查询，InnoDB表应返回多少行是不确定的

* InnoDB的count(*)优化方式
    - 用缓存保存计数，例如redis。但会存在逻辑不精确的问题，以为redis的更新总行数的顺序和mysql插入数据的顺序会造成从redis得到的总行数和mysql的总行数不一致。
    - 用mysql的单独一个表保存总行数，可参见《高性能MySQL》，为减少锁竞争，可用多行行、保存各个部分的行数，最后要获取行总数的时候，做所有的部分行数求和。**注意：当插入新数据是，先在MySQL中插入数据，再更新Redis的总行数，这样可以减小事物之间的锁等待，提高并发度**
