# Redis设计与实现--整数集合

* 整数集合是集合键的底层实现之一，当一个集合只包含整数值元素、并且这个集合的元素数量不多时，Redis就使用整数集合作为集合键的底层实现

```C
typedef struct intset {
    //编码方式,包括INTSET_ENC_INT16,INTSET_ENC_INT32,INTSET_ENC_INT64
    uint32_t encoding;

    //集合包含的元素数量
    uint32_t length;

    //保存元素的数组,虽然他的类型是int8_t，但数据的实际类型由encoding决定，里面的元素都是有序的
    int8_t contents[];
}
```

* 升级：当把一个新的元素加入整数集合里面，并且新的元素类型比整数集合现有的所有元素都要长时，整数集合需要先进行升级，然后再讲将新的元素加入到整数集合里面
    - 升级步骤
        - 根据新的元素类型，扩展整数集合底层数组的空间大小，并为新元素分配空间
        - 将底层元素现有的所有元素都转换成与新元素相同的类型，并将类型转换后的元素放在正确的位置上，需要维持元素的有序性质不变。
        - 将新元素添加到底层数组里面
    - 升级的好处
        - 提升灵活性：通过升级，整数集合可以自动适应新元素，所以可以随意的将int_16t,int_32t,int_64t添加到集合中
        - 节约空间：要同时保存int_16t,int_32t,int_64t三种数据类型，最简单的方式是直接使用int_64t，但这样会浪费空间，通过升级来使用元素代销可以节约内存空间。


                由于每次加入新元素都有可能导致升级，是的现有元素进行类型转换，所以时间复杂度为O(N)
