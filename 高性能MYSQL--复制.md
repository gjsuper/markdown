#高性能MYSQL--复制

* 复制过程：
    [MYSQL复制过程](/Users/jingjie/Documents/markdown/images/高性能MYSQL/MYSQL复制过程.jpg)
    * 在主库上记录二进制日志
    * 备库金将主库的二进制日志复制到本地的中继日志中。
        1. 启动I/O线程，跟主库建立连接
        2. 在主库上启动一个特殊的二进制转换线程，这个线程会读取主库上二进制日志中的事件,备库I/O线程将接受到的事件记录到中继日志中。
    * 备库SQL线程 从中继日志中读取事件并在备库执行，从而实现备库数据的更新

&emsp;&emsp;**主库上并发执行的操作在备库上只能串行化执行，因为只有一个SQL线程来重放日志中的事件，这时很多工作负载的性能瓶颈所在**

* 复制原理：
    - 基于语句的复制：主库记录那些造成数据更改的查询，备库实际只是把主库执行过的SQL再执行一遍。
        - 好处是简单、二进制日志里的时间更加紧凑、占用带宽少。
        - 缺点：可能不能准确的复制数据：例如：时间戳、current_user。更新必须是串行的，这些还要更多的锁。
    - 基于行的复制：会将实际数据记录在二进制日志中。
        - 好处是能够准确的复制每一行
    - MYSQL能在两种复制模式间动态切换，默认使用基于语句的复制，如果发现语句无法诶正确的复制，就切换到基于行的复制模式。
- 复制文件（10.3.4）
    - mysql-bin.index：开启日志时，用于记录包含了二进制文件的文件名。如果误删了，mysql识别不了二进制日志文件
    - mysql-relay-bin-index:中继日志的索引文件，与mysql-bin.index的作用类似
    - master.info:保存备库链接到主库所需要的信息。如果误删了，备库启动时无法连接到主库（他以文本的费那事记录了复制用户的密码，注意权限）
    - relay-log.info:包含了当前备库复制的二进制日志和中继日志坐标，如果误删了，会导致备库重启时无法获知从哪个位置开始复制，可能会导致重放已经执行过的语句。
